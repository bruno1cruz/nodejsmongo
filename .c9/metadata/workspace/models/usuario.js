{"changed":true,"filter":false,"title":"usuario.js","tooltip":"/models/usuario.js","ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":9,"column":53},"end":{"row":9,"column":53},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":46,"mode":"ace/mode/javascript"}},"value":"module.exports = function(app) {\n\n  var db = require('../lib/db_connect')(),\n      Schema = require('mongoose').Schema,\n      bcrypt = require('bcrypt'),\n      SALT_WORK_FACTOR = 10;\n\n  var usuario = Schema({\n      nome: { type: String, required: true },\n      cpf: { type: String, required: true, index: {unique : true} },\n      email: { type: String, required: true, index: {unique: true} },\n      senha: { type: String, required: true }\n  });\n  \n  usuario.pre('save', function(next) {\n    var user = this;\n    \n    if (!user.isModified('senha')) return next();\n \n    bcrypt.genSalt(SALT_WORK_FACTOR, function(err, salt) {\n      if (err) return next(err);\n      \n      bcrypt.hash(user.senha, salt, function(err, hash) {\n      \n      if (err) return next(err);\n \n      user.senha = hash;\n      next();\n      });\n    });\n  });\n  \n  return db.model('usuarios', usuario);\n};","undoManager":{"mark":0,"position":-1,"stack":[]},"timestamp":1408670151464}